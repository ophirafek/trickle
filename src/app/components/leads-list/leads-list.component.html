<div class="leads-list-container">
  <!-- Loading overlay -->
  <div *ngIf="loading" class="loading-overlay">
    <mat-spinner diameter="40"></mat-spinner>
  </div>

  <!-- Header with Add Lead button -->
  <div class="flex justify-between items-center mb-4">
    <h3 class="text-lg font-medium text-gray-700">{{ 'COMPANY_DETAIL.COMPANY_LEADS' | transloco }}</h3>
    <button 
      mat-raised-button
      color="primary"
      (click)="addLead()"
      class="flex items-center"
    >
      <mat-icon class="mr-1">add</mat-icon>
      <span>{{ 'COMPANY_DETAIL.ADD_LEAD' | transloco }}</span>
    </button>
  </div>

  <!-- Error message -->
  <div *ngIf="errorMessage" class="mb-4 bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg">
    {{ errorMessage }}
  </div>

  <!-- Leads Table -->
  <div class="overflow-x-auto" *ngIf="!loading">
    <table mat-table [dataSource]="leads" class="w-full bg-white border border-gray-200">
      
      <!-- Lead ID Column -->
      <ng-container matColumnDef="leadId">
        <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
          Lead ID
        </th>
        <td mat-cell *matCellDef="let lead" class="py-3 px-4 text-sm text-gray-900">
          {{ lead.leadId }}
        </td>
      </ng-container>

      <!-- Lead Name Column -->
      <ng-container matColumnDef="leadName">
        <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
          Lead Name
        </th>
        <td mat-cell *matCellDef="let lead" class="py-3 px-4 text-sm text-gray-900">
          {{ lead.leadName }}
        </td>
      </ng-container>

      <!-- Lead Type Column -->
      <ng-container matColumnDef="leadType">
        <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
          Lead Type
        </th>
        <td mat-cell *matCellDef="let lead" class="py-3 px-4 text-sm text-gray-900">
          {{ lead.leadTypeName || getLeadTypeName(lead.leadTypeCode) }}
        </td>
      </ng-container>

      <!-- Lead Status Column -->
      <ng-container matColumnDef="leadStatus">
        <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
          Lead Status
        </th>
        <td mat-cell *matCellDef="let lead" class="py-3 px-4 text-sm text-gray-900">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                [ngClass]="getStatusChipClass(lead.statusCode)">
            {{ lead.leadStatusName || getLeadStatusName(lead.statusCode) }}
          </span>
        </td>
      </ng-container>

      <!-- Sales Gap Value Column -->
      <ng-container matColumnDef="salesGapValue">
        <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
          Sales Gap Value
        </th>
        <td mat-cell *matCellDef="let lead" class="py-3 px-4 text-sm text-gray-900">
          <div class="flex items-center">
            <mat-icon class="text-sm mr-1">attach_money</mat-icon>
            <span>{{ lead.salesGapValue | currency:'USD':'symbol':'1.0-0' }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Probability Column -->
      <ng-container matColumnDef="probability">
        <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
          Probability
        </th>
        <td mat-cell *matCellDef="let lead" class="py-3 px-4 text-sm text-gray-900">
          <div class="flex items-center">
            <div class="w-16 bg-gray-200 rounded-full h-2 mr-2">
              <div class="bg-blue-600 h-2 rounded-full" [style.width.%]="lead.probability"></div>
            </div>
            <span>{{ lead.probability }}%</span>
          </div>
        </td>
      </ng-container>

      <!-- Market Column -->
      <ng-container matColumnDef="market">
        <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
          Market
        </th>
        <td mat-cell *matCellDef="let lead" class="py-3 px-4 text-sm text-gray-900">
          {{ lead.marketName || getMarketName(lead.marketCode) }}
        </td>
      </ng-container>

      <!-- Contact Name Column -->
      <ng-container matColumnDef="contactName">
        <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
          Contact Name
        </th>
        <td mat-cell *matCellDef="let lead" class="py-3 px-4 text-sm text-gray-900">
          {{ lead.contactName || getContactName(lead.contactId) }}
        </td>
      </ng-container>

      <!-- Owner Column -->
      <ng-container matColumnDef="owner">
        <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
          Owner
        </th>
        <td mat-cell *matCellDef="let lead" class="py-3 px-4 text-sm text-gray-900">
          <div class="flex items-center">
            <mat-icon class="text-sm mr-1">person</mat-icon>
            <span>{{ lead.ownerName || getOwnerName(lead.ownerEmployeeId) }}</span>
          </div>
        </td>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b">
          Actions
        </th>
        <td mat-cell *matCellDef="let lead" class="py-3 px-4 text-sm text-gray-900">
          <div class="flex space-x-2">
            <button 
              mat-icon-button 
              color="primary" 
              (click)="editLead(lead)"
              matTooltip="Edit Lead"
              class="p-1.5 bg-blue-100 text-blue-600 rounded hover:bg-blue-200 transition-colors">
              <mat-icon>edit</mat-icon>
            </button>
            <button 
              mat-icon-button 
              color="warn" 
              (click)="deleteLead(lead.leadId)"
              matTooltip="Delete Lead"
              class="p-1.5 bg-red-100 text-red-600 rounded hover:bg-red-200 transition-colors">
              <mat-icon>delete</mat-icon>
            </button>
          </div>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-gray-50"></tr>

      <!-- No data row -->
      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell text-center p-8" [attr.colspan]="displayedColumns.length">
          <div class="flex flex-col items-center">
            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mb-4">
              <mat-icon class="text-gray-400 text-3xl">track_changes</mat-icon>
            </div>
            <h3 class="text-lg font-medium text-gray-800 mb-1">No leads found</h3>
            <p class="text-gray-500 mb-4">No leads have been created for this company yet.</p>
            <button 
              mat-raised-button
              color="primary"
              (click)="addLead()"
              class="flex items-center">
              <mat-icon class="mr-1">add</mat-icon>
              <span>{{ 'COMPANY_DETAIL.ADD_LEAD' | transloco }}</span>
            </button>
          </div>
        </td>
      </tr>
    </table>
  </div>
</div>