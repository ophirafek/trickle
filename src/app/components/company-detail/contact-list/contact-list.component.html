<!-- contact-list.component.html -->
<div class="contact-list-container">
    <!-- Loading overlay -->
    <div *ngIf="loading" class="loading-overlay">
      <mat-spinner diameter="40"></mat-spinner>
    </div>
  
    <div class="flex justify-between mb-4">
      <h3 class="text-lg font-medium text-gray-700">{{ 'COMPANY_DETAIL.CONTACT_INFORMATION' | transloco }}</h3>
      <button 
        mat-raised-button
        color="primary"
        (click)="startAddingContact()"
        *ngIf="!isAddingContact && !isEditingContact"
        class="flex items-center"
      >
        <mat-icon class="mr-1">add</mat-icon>
        <span>{{ 'COMPANY_DETAIL.ADD_CONTACT' | transloco }}</span>
      </button>
    </div>
    
    <!-- Contact error message -->
    <div *ngIf="contactError" class="mb-4 bg-red-50 border border-red-200 text-red-600 px-4 py-3 rounded-lg">
      {{ contactError }}
    </div>
    
    <!-- Contact Form (Shared for Add/Edit) -->
    <div *ngIf="isAddingContact || isEditingContact" class="border border-gray-200 rounded-md p-4 mb-6 bg-gray-50">
      <h3 class="text-lg font-medium text-gray-700 mb-4">
        {{ isAddingContact ? ('COMPANY_DETAIL.NEW_CONTACT' | transloco) : ('COMPANY_DETAIL.EDIT_CONTACT' | transloco) }}
      </h3>
      <div class="grid grid-cols-2 gap-4">
        <div>
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'COMPANY_DETAIL.CONTACT_FIRST_NAME' | transloco }} <span class="text-red-500">*</span></mat-label>
            <input matInput [(ngModel)]="currentContact.firstName" placeholder="First name">
          </mat-form-field>
        </div>
        
        <div>
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'COMPANY_DETAIL.CONTACT_LAST_NAME' | transloco }}</mat-label>
            <input matInput [(ngModel)]="currentContact.lastName" placeholder="Last name">
          </mat-form-field>
        </div>
        
        <div>
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'COMPANY_DETAIL.CONTACT_CODE' | transloco }}</mat-label>
            <mat-select [(ngModel)]="currentContact.contactCode">
              <mat-option [value]="null">{{ 'COMMON.NOT_SPECIFIED' | transloco }}</mat-option>
              <mat-option *ngFor="let code of contactCodes" [value]="code.codeNumber">
                {{ code.codeShortDescription }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        
        <div>
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'COMPANY_DETAIL.CONTACT_ID' | transloco }}</mat-label>
            <input matInput [(ngModel)]="currentContact.personalID" placeholder="Personal ID">
          </mat-form-field>
        </div>
        
        <div>
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'COMPANY_DETAIL.CONTACT_POSITION' | transloco }}</mat-label>
            <input matInput [(ngModel)]="currentContact.position" placeholder="Position">
          </mat-form-field>
        </div>
        
        <div>
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'COMPANY_DETAIL.CONTACT_DEPARTMENT' | transloco }}</mat-label>
            <input matInput [(ngModel)]="currentContact.department" placeholder="Department">
          </mat-form-field>
        </div>
        
        <div>
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'COMPANY_DETAIL.CONTACT_PHONE' | transloco }}</mat-label>
            <input matInput [(ngModel)]="currentContact.phoneNumber" placeholder="Phone number">
          </mat-form-field>
        </div>
        
        <div>
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'COMPANY_DETAIL.CONTACT_CELL' | transloco }}</mat-label>
            <input matInput [(ngModel)]="currentContact.cellNumber" placeholder="Cell number">
          </mat-form-field>
        </div>
        
        <div>
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'COMPANY_DETAIL.CONTACT_FAX' | transloco }}</mat-label>
            <input matInput [(ngModel)]="currentContact.faxNumber" placeholder="Fax number">
          </mat-form-field>
        </div>
        
        <div>
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'COMPANY_DETAIL.CONTACT_EMAIL' | transloco }}</mat-label>
            <input matInput type="email" [(ngModel)]="currentContact.email" placeholder="Email address">
          </mat-form-field>
        </div>
        
        <div class="col-span-2">
          <mat-form-field appearance="outline" class="w-full">
            <mat-label>{{ 'COMPANY_DETAIL.CONTACT_NOTES' | transloco }}</mat-label>
            <textarea matInput [(ngModel)]="currentContact.notes" placeholder="Notes" rows="3"></textarea>
          </mat-form-field>
        </div>
      </div>
      <div class="flex justify-end space-x-2 mt-4">
        <button mat-button (click)="cancelForm()">{{ 'BUTTONS.CANCEL' | transloco }}</button>
        <button mat-raised-button color="primary" (click)="saveContact()">{{ 'BUTTONS.SAVE' | transloco }}</button>
      </div>
    </div>
    
    <!-- Contacts Table -->
    <div class="overflow-x-auto" *ngIf="!isAddingContact && !isEditingContact">
      <table mat-table [dataSource]="contacts" class="w-full bg-white border border-gray-200">
        <ng-container matColumnDef="fullName">
          <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b"> 
            {{ 'COMPANY_DETAIL.CONTACT_NAME' | transloco }} 
          </th>
          <td mat-cell *matCellDef="let contact" class="py-3 px-4 text-sm text-gray-900"> 
            {{contact.fullName || (contact.firstName + ' ' + contact.lastName)}}
          </td>
        </ng-container>
        
        <ng-container matColumnDef="contactCode">
          <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b"> 
            {{ 'COMPANY_DETAIL.CONTACT_CODE' | transloco }} 
          </th>
          <td mat-cell *matCellDef="let contact" class="py-3 px-4 text-sm text-gray-900"> 
            {{ contact.contactCode ? getContactCodeDescription(contact.contactCode) : '' }}
          </td>
        </ng-container>
        
        <ng-container matColumnDef="position">
          <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b"> 
            {{ 'COMPANY_DETAIL.CONTACT_POSITION' | transloco }} 
          </th>
          <td mat-cell *matCellDef="let contact" class="py-3 px-4 text-sm text-gray-900"> 
            {{contact.position}}
            <span *ngIf="contact.department" class="text-gray-500 text-xs">({{contact.department}})</span>
          </td>
        </ng-container>
        
        <ng-container matColumnDef="phoneNumber">
          <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b"> 
            {{ 'COMPANY_DETAIL.CONTACT_PHONE' | transloco }} 
          </th>
          <td mat-cell *matCellDef="let contact" class="py-3 px-4 text-sm text-gray-900"> 
            <div>{{contact.phoneNumber}}</div>
            <div *ngIf="contact.cellNumber" class="text-xs text-gray-500">Cell: {{contact.cellNumber}}</div>
          </td>
        </ng-container>
        
        <ng-container matColumnDef="email">
          <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b"> 
            {{ 'COMPANY_DETAIL.CONTACT_EMAIL' | transloco }} 
          </th>
          <td mat-cell *matCellDef="let contact" class="py-3 px-4 text-sm text-gray-900"> 
            <a *ngIf="contact.email" href="mailto:{{contact.email}}" class="text-blue-600 hover:underline">
              {{contact.email}}
            </a>
          </td>
        </ng-container>
        
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef class="py-3 px-4 text-left text-xs font-medium text-gray-500 uppercase tracking-wider border-b"> 
            {{ 'COMMON.ACTIONS' | transloco }} 
          </th>
          <td mat-cell *matCellDef="let contact" class="py-3 px-4 text-sm text-gray-900"> 
            <div class="flex space-x-2">
              <button mat-icon-button color="primary" (click)="startEditingContact(contact)" class="p-1.5 bg-blue-100 text-blue-600 rounded hover:bg-blue-200 transition-colors">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deleteContact(contact.id)" class="p-1.5 bg-red-100 text-red-600 rounded hover:bg-red-200 transition-colors">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>
        
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-gray-50"></tr>
        
        <!-- No data row -->
        <tr class="mat-row" *matNoDataRow>
          <td class="mat-cell text-center p-4" colspan="6">
            {{ 'COMPANY_DETAIL.NO_CONTACTS' | transloco }}
          </td>
        </tr>
      </table>
    </div>
  </div>