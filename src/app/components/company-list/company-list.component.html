<!-- company-list.component.html -->
<div class="container-fluid h-100 d-flex flex-column bg-light">
  <!-- Header -->
  <mat-toolbar color="primary" class="mat-elevation-z4">
    <span class="font-weight-bold">Company Browse</span>
    <span class="flex-spacer"></span>
  </mat-toolbar>

  <!-- Main Content -->
  <div class="content-area p-4 overflow-auto">
    <mat-card class="mat-elevation-z2">
      <!-- Filter Section -->
      <mat-card-header class="filter-header">
        <mat-card-title>Search Companies</mat-card-title>
        <button mat-icon-button (click)="toggleFilters()">
          <mat-icon>{{ showFilters ? 'expand_less' : 'expand_more' }}</mat-icon>
        </button>
      </mat-card-header>
      
      <mat-card-content *ngIf="showFilters" [formGroup]="filterForm">
        <!-- Basic Search Filters -->
        <div class="row mb-3">
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Company Name</mat-label>
              <input matInput formControlName="companyName" placeholder="Search company name...">
              <button mat-icon-button matSuffix (click)="applyFilters()">
                <mat-icon>search</mat-icon>
              </button>
            </mat-form-field>
          </div>
          
          <div class="col-md-6">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Primary ID</mat-label>
              <input matInput formControlName="primaryId" placeholder="Registration/VAT/DUNS number...">
            </mat-form-field>
          </div>
        </div>
        
        <!-- Toggle Advanced Search Button -->
        <div class="text-center mb-3">
          <button mat-button color="primary" (click)="toggleAdvancedFilters()">
            <mat-icon>{{ showAdvancedFilters ? 'expand_less' : 'expand_more' }}</mat-icon>
            {{ showAdvancedFilters ? 'Hide Advanced Search' : 'Show Advanced Search' }}
          </button>
        </div>
        
        <!-- Advanced Search Filters -->
        <div *ngIf="showAdvancedFilters" class="row py-3 border-top">
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Country</mat-label>
              <mat-select formControlName="country">
                <mat-option value="">All Countries</mat-option>
                <mat-option *ngFor="let country of countries" [value]="country">
                  {{ country }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Business Field</mat-label>
              <mat-select formControlName="businessField">
                <mat-option value="">All Fields</mat-option>
                <mat-option *ngFor="let field of businessFields" [value]="field">
                  {{ field }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Company Status</mat-label>
              <mat-select formControlName="companyStatus">
                <mat-option value="">All Statuses</mat-option>
                <mat-option *ngFor="let status of companyStatuses" [value]="status">
                  {{ status }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="w-100">
              <mat-label>Entity Type</mat-label>
              <mat-select formControlName="entityType">
                <mat-option value="">All Entity Types</mat-option>
                <mat-option value="debtor">Debtor</mat-option>
                <mat-option value="insured">Insured</mat-option>
                <mat-option value="potential">Potential Customer</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          
          <div class="col-md-8">
            <div class="row">
              <div class="col-12">
                <mat-label class="mb-2 d-block">Obligatory Amount</mat-label>
              </div>
              <div class="col-md-6">
                <mat-form-field appearance="outline" class="w-100">
                  <mat-label>Min</mat-label>
                  <input matInput formControlName="obligatoryMin" placeholder="Min">
                </mat-form-field>
              </div>
              <div class="col-md-6">
                <mat-form-field appearance="outline" class="w-100">
                  <mat-label>Max</mat-label>
                  <input matInput formControlName="obligatoryMax" placeholder="Max">
                </mat-form-field>
              </div>
            </div>
          </div>
        </div>
        
        <div class="d-flex justify-content-end mt-3">
          <button mat-stroked-button class="me-2" (click)="clearFilters()">
            <mat-icon>clear</mat-icon> Clear Filters
          </button>
          <button mat-flat-button color="primary" (click)="applyFilters()">
            <mat-icon>filter_list</mat-icon> Apply Filters
          </button>
        </div>
      </mat-card-content>
      
      <!-- Results Table -->
      <div class="p-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <h3 class="fw-medium text-muted">Results ({{ companies.length }})</h3>
        </div>
        
        <div class="table-container">
          <table mat-table [dataSource]="companies" class="w-100">
            
            <!-- Company Name Column -->
            <ng-container matColumnDef="registrationName">
              <th mat-header-cell *matHeaderCellDef> Company Name </th>
              <td mat-cell *matCellDef="let company" class="fw-medium"> {{ company.registrationName }} </td>
            </ng-container>
            
            <!-- Primary ID Column -->
            <ng-container matColumnDef="primaryId">
              <th mat-header-cell *matHeaderCellDef> Primary ID </th>
              <td mat-cell *matCellDef="let company">
                <div class="d-flex flex-column">
                  <small class="text-muted">{{ getPrimaryIdType(company) }}</small>
                  <span>{{ getPrimaryId(company) }}</span>
                </div>
              </td>
            </ng-container>
            
            <!-- Country Column -->
            <ng-container matColumnDef="country">
              <th mat-header-cell *matHeaderCellDef> Country </th>
              <td mat-cell *matCellDef="let company"> {{ getCountryName(company.countryCode) }} </td>
            </ng-container>
            
            <!-- Business Field Column -->
            <ng-container matColumnDef="businessField">
              <th mat-header-cell *matHeaderCellDef> Business Field </th>
              <td mat-cell *matCellDef="let company"> {{ getBusinessFieldName(company.businessFieldCode) }} </td>
            </ng-container>
            
            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef> Status </th>
              <td mat-cell *matCellDef="let company">
                <span class="status-badge" 
                  [ngClass]="{
                    'active-badge': getStatusName(company.companyStatusCode) === 'Active',
                    'inactive-badge': getStatusName(company.companyStatusCode) === 'Inactive',
                    'onhold-badge': getStatusName(company.companyStatusCode) === 'On Hold'
                  }">
                  {{ getStatusName(company.companyStatusCode) }}
                </span>
              </td>
            </ng-container>
            
            <!-- Entity Type Column -->
            <ng-container matColumnDef="entityType">
              <th mat-header-cell *matHeaderCellDef> Entity Type </th>
              <td mat-cell *matCellDef="let company">
                <div class="d-flex flex-wrap gap-1">
                  <span class="entity-badge debtor-badge" *ngIf="company.isDebtor">Debtor</span>
                  <span class="entity-badge insured-badge" *ngIf="company.isInsuredCompany">Insured</span>
                  <span class="entity-badge potential-badge" *ngIf="company.isPotentialCustomer">Potential</span>
                  <span class="entity-badge agent-badge" *ngIf="company.isAgent">Agent</span>
                  <span *ngIf="!company.isDebtor && !company.isInsuredCompany && !company.isPotentialCustomer && !company.isAgent">-</span>
                </div>
              </td>
            </ng-container>
            
            <!-- Obligatory Amount Column -->
            <ng-container matColumnDef="obligatoryAmount">
              <th mat-header-cell *matHeaderCellDef> Obligatory Amount </th>
              <td mat-cell *matCellDef="let company"> {{ company.obligatoryAmount }} </td>
            </ng-container>
            
            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef class="text-center"> Actions </th>
              <td mat-cell *matCellDef="let company" class="text-center">
                <button mat-icon-button color="primary" class="btn-action" (click)="viewCompanyDetails(company)">
                  <mat-icon>arrow_right_alt</mat-icon>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover-row"></tr>
          </table>
          
          <!-- No Results Message -->
          <div *ngIf="companies.length === 0" class="text-center py-5">
            <p class="text-muted">No companies match your search criteria.</p>
            <button mat-button color="primary" class="mt-3" (click)="clearFilters()">
              Clear filters to see all companies
            </button>
          </div>
        </div>
      </div>
    </mat-card>
  </div>
</div>